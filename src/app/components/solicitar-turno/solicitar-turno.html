<div class="solicitar-turno-container">
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <div class="navbar">
    <div class="navbar-content">
      <button class="btn-volver" (click)="volver()">‚Üê Volver</button>
      <h1>Solicitar Turno</h1>
    </div>
  </div>

  <div class="pasos-indicador">
    <div class="paso" [class.activo]="paso >= 1" [class.completado]="paso > 1">
      <span class="numero">1</span>
      <span class="texto">Especialista</span>
    </div>
    <div class="paso" [class.activo]="paso >= 2" [class.completado]="paso > 2">
      <span class="numero">2</span>
      <span class="texto">Especialidad</span>
    </div>
    <div class="paso" [class.activo]="paso >= 3" [class.completado]="paso > 3">
      <span class="numero">3</span>
      <span class="texto">Fecha</span>
    </div>
    <div class="paso" [class.activo]="paso >= 4" [class.completado]="paso > 4">
      <span class="numero">4</span>
      <span class="texto">Horario</span>
    </div>
  </div>

  <div *ngIf="paso === 1" class="paso-container">
    <h2>Selecciona un Especialista</h2>

    <div *ngIf="isAdmin && !pacienteSeleccionado" class="pacientes-section">
      <h3>Primero selecciona el paciente:</h3>
      <div class="pacientes-grid">
        <div *ngFor="let paciente of pacientes"
             class="paciente-card"
             (click)="seleccionarPaciente(paciente)">
          <img [src]="paciente.imagen_perfil_1 || 'assets/default-avatar.png'"
               alt="{{ paciente.nombre }}">
          <h4>{{ paciente.nombre }} {{ paciente.apellido }}</h4>
          <p>DNI: {{ paciente.dni }}</p>
        </div>
      </div>
    </div>

    <div *ngIf="!isAdmin || pacienteSeleccionado" class="especialistas-grid">
      <div *ngFor="let esp of especialistas"
           class="especialista-card"
           (click)="seleccionarEspecialista(esp)">
        <img [src]="esp.imagen_perfil_1 || 'assets/default-avatar.png'"
             alt="{{ esp.nombre }}">
        <h3>{{ esp.nombre }} {{ esp.apellido }}</h3>
        <div class="especialidades-tags">
          <span *ngFor="let especialidad of esp.especialidades" class="tag">
            {{ especialidad.nombre }}
          </span>
        </div>
      </div>
    </div>

    <p *ngIf="especialistas.length === 0 && !loading" class="mensaje-vacio">
      No hay especialistas disponibles en este momento
    </p>
  </div>

  <div *ngIf="paso === 2" class="paso-container">
    <h2>Selecciona una Especialidad</h2>

    <div class="info-seleccion">
      <p><strong>Especialista:</strong> {{ especialistaSeleccionado?.nombre }} {{ especialistaSeleccionado?.apellido }}</p>
    </div>

    <div class="especialidades-grid">
      <div *ngFor="let especialidad of especialistaSeleccionado?.especialidades"
           class="especialidad-card"
           (click)="seleccionarEspecialidad(especialidad)">
        <h3>{{ especialidad.nombre }}</h3>
      </div>
    </div>
  </div>

  <div *ngIf="paso === 3" class="paso-container">
    <h2>Selecciona una Fecha</h2>

    <div class="info-seleccion">
      <p><strong>Especialista:</strong> {{ especialistaSeleccionado?.nombre }} {{ especialistaSeleccionado?.apellido }}</p>
      <p><strong>Especialidad:</strong> {{ especialidadSeleccionada?.nombre }}</p>
    </div>

    <div class="fechas-grid">
      <div *ngFor="let fecha of fechasDisponibles"
           class="fecha-card"
           [class.seleccionada]="esFechaSeleccionada(fecha)"
           (click)="seleccionarFecha(fecha)">
        <div class="dia">{{ formatearFechaCorta(fecha) }}</div>
        <div class="fecha-completa">{{ formatearFecha(fecha) }}</div>
      </div>
    </div>
  </div>

  <div *ngIf="paso === 4" class="paso-container">
    <h2>Selecciona un Horario</h2>

    <div class="info-seleccion">
      <p><strong>Especialista:</strong> {{ especialistaSeleccionado?.nombre }} {{ especialistaSeleccionado?.apellido }}</p>
      <p><strong>Especialidad:</strong> {{ especialidadSeleccionada?.nombre }}</p>
      <p><strong>Fecha:</strong> {{ formatearFecha(fechaSeleccionada) }}</p>
    </div>

    <div class="horarios-grid">
      <div *ngFor="let horario of horariosDisponibles"
           class="horario-card"
           [class.seleccionado]="horarioSeleccionado === horario"
           (click)="seleccionarHorario(horario)">
        {{ horario }}
      </div>
    </div>

    <p *ngIf="horariosDisponibles.length === 0 && !loading" class="mensaje-vacio">
      No hay horarios disponibles para esta fecha
    </p>

    <button *ngIf="horarioSeleccionado"
            class="btn-confirmar"
            [disabled]="loading"
            (click)="confirmarTurno()">
      Confirmar Turno
    </button>
  </div>

</div>
