<div class="usuarios-container">
  <nav class="navbar">
    <div class="navbar-content">
      <h1> Gestión de Usuarios</h1>
      <div class="navbar-actions">
        <button class="btn-secondary" (click)="volverAlHome()">← Volver al Home</button>
      </div>
    </div>
  </nav>

  <div class="content">
    <div class="filters-section">
      <div class="search-box">
        <input 
          type="text" 
          placeholder="Buscar por nombre, email o DNI..."
          [(ngModel)]="filtroBusqueda"
          (ngModelChange)="aplicarFiltros()">
      </div>

      <select [(ngModel)]="filtroRole" (ngModelChange)="aplicarFiltros()" class="filter-select">
        <option value="todos">Todos los roles</option>
        <option value="paciente">Pacientes</option>
        <option value="especialista">Especialistas</option>
        <option value="admin">Administradores</option>
      </select>

      <button class="btn-primary" (click)="abrirModalCrear()">
        + Crear Usuario
      </button>
    </div>

    <div class="usuarios-grid" *ngIf="!loading" [@slideUp]>
      <div 
        *ngFor="let usuario of usuariosFiltrados; let i = index" 
        class="usuario-card" 
        [@fadeInUp]
        [style.animation-delay]="(i * 0.05) + 's'"
        (click)="descargarExcelUsuario(usuario)"
        title="Click para descargar Excel con turnos">
        <button class="fav-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </button>
        <div class="usuario-avatar">
          <img [src]="usuario.imagen_perfil_1" *ngIf="usuario.imagen_perfil_1" [alt]="usuario.nombre">
          <div class="avatar-placeholder" *ngIf="!usuario.imagen_perfil_1">
            {{ usuario.nombre.charAt(0) || '' }}{{ usuario.apellido.charAt(0) || '' }}
          </div>
        </div>
        <h3 class="usuario-nombre">{{ usuario.nombre }} {{ usuario.apellido }}</h3>
        <p class="usuario-email">{{ usuario.email }}</p>
        <div class="usuario-badges">
          <span [class]="getRoleBadgeClass(usuario.role)">
            {{ usuario.role }}
          </span>
          <span [class]="getApprovedBadgeClass(usuario.approved)">
            {{ usuario.approved ? 'Habilitado' : 'Deshabilitado' }}
          </span>
        </div>
        <div class="card-actions" (click)="$event.stopPropagation()">
          <button 
            *ngIf="usuario.role === 'especialista'"
            [class]="usuario.approved ? 'btn-danger-sm' : 'btn-success-sm'"
            (click)="toggleAprobacion(usuario)">
            {{ usuario.approved ? 'Deshabilitar' : 'Habilitar' }}
          </button>
          <button 
            class="btn-danger-sm"
            (click)="eliminarUsuario(usuario)"
            [disabled]="usuario.id === currentUser?.id">
            Eliminar
          </button>
        </div>
      </div>

      <p *ngIf="usuariosFiltrados.length === 0" class="no-results">
        No se encontraron usuarios
      </p>
    </div>

    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Cargando usuarios...</p>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="mostrarModalCrear" (click)="cerrarModalCrear()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <app-registro
        [esModal]="true"
        [mostrarTipoAdmin]="true"
        (registroExitoso)="onRegistroExitoso()"
        (cancelar)="cerrarModalCrear()">
      </app-registro>
    </div>
  </div>
</div>